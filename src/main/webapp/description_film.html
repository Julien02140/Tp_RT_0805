<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/css/style.css">
    <title>Description du Film</title>
</head>
<body>
    <div id="base-content"></div>


    <pre id="json-container"></pre>

    <span id="username"></span>

    <span id="film-id"></span>

    <span id="film-title"></span>

    <!-- <h1>Bienvenue, <span id="film-id"></span>!</h1>
    <h1>Bienvenue, <span id="film-title"></span>!</h1>
    <h1>Bienvenue, <span id="film-date-sortie"></span>!</h1>
    <h1>Bienvenue, <span id="film-moyenne"></span>!</h1>
    <h1>Bienvenue, <span id="film-nb-vote"></span>!</h1> -->

    <!-- <div class="film-container"> -->
        <!-- <span id="film-title"></span> -->
        

            <!-- <img id="image_poster"> -->

            <!-- <div class="film-info"> -->
                <!-- <a id="bouton">Ajouter le film</a> -->
                <!-- </br>
                </br>
                <p id="date_sortie"></p>
                <p id="moyenne"></p>
                <p id="nb_vote"></p>
                <p id="synopsis"></p> -->
            <!-- </div> -->

            <!-- <h4>Noter le film</h4>
            <p> Vous pourrez modifier votre note à tout moment</p>
            <form method="POST" action="/rest/ajout_note">
                <label for="rating">Note : </label>
                <input type="number" id="note" name="note" min="1" max="10" required>
                
                <input type="hidden" id="id" name="id" value="{{ film.id }}">
                <button class="btn btn-primary" type="submit">Soumettre</button>
            </form> -->
    <!-- </div> -->

    <script>
        
         document.addEventListener('DOMContentLoaded', (event) => {
            const urlParams = new URLSearchParams(window.location.search);
            const filmId = urlParams.get('id');
            fetch('/rest/username')
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        } else {
                            throw new Error('Non autorisé');
                        }
                    })
                    .then(data => {
                            document.getElementById('username').textContent = data.username;
                        })
                    .catch(error => {
                        console.error('Erreur:', error);
                        window.location.href = '../index.html';
                    });

            fetch("/rest/trouver_film?film_id=" + filmId)
                    .then(response => response.json())
                    .then(film => {
                        
                        const jsonContainer = document.getElementById('json-container');
                        jsonContainer.textContent = JSON.stringify(film, null, 2); // Formatage avec 2 espaces pour la lisibilité

                        // const filmdetail = document.getElementById('film_detail');
 
                        // const h5 = document.createElement('h5');
                        // h5.textContent = film.title;

                        document.getElementById('film-id').textContent = film.id;                        
                        document.getElementById('film-title').textContent = film.title;
                        document.getElementById('film-date-sortie').textContent = film.releaseDate;
                        document.getElementById('film-moyenne').textContent = film.moyenne;
                        document.getElementById('film-nb-vote').textContent = film.nbVote;
                        document.getElementById('film-synopsis').textContent = film.overview;
                        document.getElementById('poster_path').textContent = film.posterPath;

                        // const img = document.getElementById('image_poster');
                        // img.src = "https://image.tmdb.org/t/p/w342/" + film.posterPath;
                        // img.alt = "{{ film.title }} Poster";

                        // const a = document.getElementById('bouton');
                        // a.href = "/rest/ajouter_film/" + filmId;
                        // a.classList.add('btn', 'btn-primary');

                    })
                    .catch(error => console.error('Erreur lors de la récupération des films:', error));

            fetch('base_site.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('base-content').innerHTML = data;
            });

        });
    </script>
</body>
</html>