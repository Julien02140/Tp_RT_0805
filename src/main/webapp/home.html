<body>
    <div id="base-content"></div>
    <h1>Bienvenue, <span id="username"></span>!</h1>
    <h1>Bienvenue, <span id="isAdmin"></span>!</h1>
    <!-- <h1>Test, <span id="testfilm"></span>!</h1> -->
    <h1>poster_path, <span id="poster_path"></span>!</h1>
    <p>Les films populaires du moment</p>
    <div id="films-list"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
        
        // function load_name_user(){
        document.addEventListener('DOMContentLoaded', (event) => {
            fetch('/rest/username')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Non autorisé');
                    }
                })
                .then(data => {
                        document.getElementById('username').textContent = data.username;
                        document.getElementById('isAdmin').textContent = data.isAdmin;
                    })
                .catch(error => {
                    console.error('Erreur:', error);
                    window.location.href = '../index.html';
                });

            fetch('/rest/films_populaires')
                .then(response => response.json())
                .then(films => {
                    document.getElementById('poster_path').textContent = "https://image.tmdb.org/t/p/w342" + films[0].posterPath;
                    const filmsList = document.getElementById('films-list');
                    const ul = document.createElement('ul');
                    ul.classList.add('film-list');

                    films.forEach(film => {
                        const li = document.createElement('li');
                        li.classList.add('film-list-item');
                        li.setAttribute('data-bs-toggle', 'tooltip');
                        li.setAttribute('data-bs-placement', 'top');

                        const h5 = document.createElement('h5');
                        h5.textContent = film.title;

                        const a = document.createElement('a');
                        a.href = "/rest/description_film?film_id=" + film.id;

                        const img = document.createElement('img');
                        img.src = "https://image.tmdb.org/t/p/w342" + film.posterPath;
                        img.alt = film.title + " Poster";

                        a.appendChild(img);

                        li.appendChild(h5);
                        li.appendChild(a);
                        
                        ul.appendChild(li);
                    });
                    filmsList.appendChild(ul);
                })
                .catch(error => console.error('Erreur lors de la récupération des films:', error));

            fetch('base_site.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('base-content').innerHTML = data;
                });
        });
    </script>

</body>
</html>
